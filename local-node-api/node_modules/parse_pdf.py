#!/usr/bin/env python3

import sys
import json
import pdfplumber

def extract_tables_and_text(pdf_bytes):
    text_output = ""
    tables_output = []
    with pdfplumber.open(pdf_bytes) as pdf:
        for page in pdf.pages:
            # Extract plain text
            page_text = page.extract_text() or ""
            text_output += page_text + "\n"

            # Extract tables. Each table is a list of rows;
            # each row is a list of cell values
            page_tables = page.extract_tables()
            if page_tables:
                # Could flatten or store directly
                tables_output.extend(page_tables)
    return text_output.strip(), tables_output

def main():
    # Read entire PDF from stdin
    pdf_bytes = sys.stdin.buffer.read()
    text, tables = extract_tables_and_text(pdf_bytes)

    # Build a JSON object
    result = {
        "text": text,
        "tables": tables
    }
    print(json.dumps(result))

if __name__ == "__main__":
    main()
